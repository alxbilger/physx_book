name: Render pdf
on: 
    push:
    workflow_dispatch:
jobs:
  render-book:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v4
        - uses: typst-community/setup-typst@v4
        - name: Add details
          run: |
            echo "Compiled from #link(\"https://github.com/alxbilger/physx_book/commit/${{ github.sha }}\")[${{ github.sha }}] from " >> details.typ
            typst --version >> details.typ
        - run: typst compile main.typ physx_book.pdf
        - name: Upload Artifacts
          uses: actions/upload-artifact@v4
          with:
              name: PDF
              path: 'physx_book.pdf'
        - name: Release
          uses: softprops/action-gh-release@v2
          if: github.ref_type == 'tag'
          with:
              name: "${{ github.ref_name }}"
              files: physx_book.pdf